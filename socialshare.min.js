/**
 * Copyright 2015 PhotoShelter, Inc.
 * @license
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
(function(){function SocialShare(){}SocialShare.prototype.share=function(data,cb){throw new Error("share() must be implemented by subclass")};function FacebookShare(){SocialShare.call(this,arguments)}FacebookShare.prototype=Object.create(SocialShare.prototype);FacebookShare.prototype.share=function(data,cb){if(!window.FB)throw new Error("FB library not loaded, what the heck.");data=data||{};window.FB.ui({method:"share",href:data.url||window.location.href},function(response){if(response&&!response.error_code&&cb){cb()}})};function TwitterShare(){SocialShare.call(this,arguments)}TwitterShare.prototype=Object.create(SocialShare.prototype);TwitterShare.prototype.share=function(data,cb){if(!window.twttr)throw new Error("Twitter library not loaded, what the heck.");data=data||{};this.attachCb(cb);var tweetIntentUrl="https://twitter.com/intent/tweet?";var queryParams={url:data.url||window.location.href,text:data.caption||""};var href=tweetIntentUrl+makeQueryString(queryParams);simulateAnchorClick({href:href})};TwitterShare.prototype.attachCb=function(cb){window.twttr.events.bind("tweet",function(ev){cb&&cb();window.twttr.events.unbind("tweet")})};function GPlusShare(){SocialShare.call(this,arguments)}GPlusShare.prototype=Object.create(SocialShare.prototype);GPlusShare.prototype.share=function(data){if(!window.gapi)throw new Error("Google plus library not loaded, what the heck.");data=data||{};var url=encodeURIComponent(data.url||window.location.href);var href="https://plus.google.com/share?url={"+url+"}";var onClick=function(e){window.open(e.target.href,"","menubar=no,toolbar=no,resizable=yes,"+"scrollbars=yes,height=600,width=600");return false};simulateAnchorClick({href:href},{onclick:onClick})};function PinterestShare(){SocialShare.call(this,arguments)}PinterestShare.prototype=Object.create(SocialShare.prototype);PinterestShare.prototype.share=function(data){if(!window.PDK)throw new Error("Pinterest library not loaded, what the heck.");data=data||{};PDK.pin(data.imgUrl,data.caption,data.url)};function EmailShare(){SocialShare.call(this,arguments)}EmailShare.prototype=Object.create(SocialShare.prototype);EmailShare.prototype.share=function(data){data=data||{};var mailtoHref="mailto:"+(data.to||"")+"?"+makeQueryString({subject:data.subject||"",body:data.body||""});simulateAnchorClick({href:mailtoHref},{})};function makeQueryString(obj){var str=[];for(var p in obj)if(obj.hasOwnProperty(p)){str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]))}return str.join("&")}function simulateAnchorClick(attrs,listeners){var a=createAnchor(attrs,listeners);document.body.appendChild(a);if(a.click)a.click();else if(a.fireEvent)a.fireEvent("onclick");else{var evObj=document.createEvent("Events");evObj.initEvent("click",true,false);a.dispatchEvent(evObj)}document.body.removeChild(a)}function createAnchor(attrs,listeners){var a=document.createElement("a");Object.keys(attrs||{}).forEach(function(k){a.setAttribute(k,attrs[k])});Object.keys(listeners||{}).forEach(function(k){a[k]=listeners[k]});a.setAttribute("class","anchor-wrapper");return a}var services={facebook:new FacebookShare,twitter:new TwitterShare,gplus:new GPlusShare,pinterest:new PinterestShare,email:new EmailShare};function share(service,data,cb){var serv=services[service];if(!serv)throw new Error("Pass a valid service");serv.share(data,cb)}if(typeof module!=="undefined"&&module.exports){exports.share=share;exports.constructors={SocialShare:SocialShare,FacebookShare:FacebookShare,TwitterShare:TwitterShare,GPlusShare:GPlusShare,PinterestShare:PinterestShare};exports.utils={simulateAnchorClick:simulateAnchorClick,makeQueryString:makeQueryString}}else{window.socialShare=share}})();